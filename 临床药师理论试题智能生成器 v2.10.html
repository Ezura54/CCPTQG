<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>临床药师理论试题智能生成器 v2.10 (A型题规范版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 引入思源宋体/Noto Serif SC 以增加试卷正式感 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        body { 
            font-family: 'Noto Sans SC', sans-serif; /* 界面UI字体 */
            background-color: #f3f4f6;
        }

        /* ---------------- 试卷纸张效果 CSS ---------------- */
        .paper-container {
            background-color: white;
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            margin: 0 auto;
            padding: 20mm;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            color: #000;
            font-family: 'Noto Serif SC', 'SimSun', serif; /* 试卷内容字体：宋体风格 */
            line-height: 1.6;
        }

        .exam-content h1 {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            color: #000;
            page-break-before: always;
        }
        /* 第一个标题不分页 */
        .exam-content h1:first-child {
            page-break-before: auto;
        }

        .exam-content .exam-header-info {
            text-align: center;
            margin-bottom: 30px;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 14px;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
        }

        .exam-content h2 {
            font-size: 18px;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 15px;
            padding: 5px 10px;
            background-color: #f0f0f0;
            border-left: 5px solid #4b5563;
        }

        .exam-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .exam-content p {
            margin-bottom: 10px;
            text-align: justify;
        }

        /* 题目选项优化 */
        .exam-content ul {
            list-style-type: none;
            padding-left: 0;
            margin-bottom: 15px;
        }
        
        .exam-content li {
            padding-left: 20px;
            text-indent: -20px; /* 悬挂缩进 */
            margin-bottom: 5px;
        }

        /* 强调文字（如否定词） */
        .exam-content strong {
            font-weight: 800;
            text-decoration: underline; /* 加下划线增强醒目 */
        }

        /* 知识点标注样式 */
        .knowledge-point {
            font-size: 0.9em;
            color: #666;
            font-family: 'Noto Sans SC', sans-serif;
            float: right;
        }

        /* 答案区样式 - 修正为简单的文本块 */
        .answer-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #ccc;
        }

        /* Loading */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 打印样式优化 */
        @media print {
            body * { visibility: hidden; }
            #previewContainer, #previewContainer * { visibility: visible; }
            #previewContainer {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            aside, header { display: none; }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm z-20 border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-gray-900 leading-tight">临床药师试题生成器</h1>
                    <p class="text-xs text-gray-500">v2.10 A型题规范版 | 支持 Gemini/DeepSeek</p>
                </div>
            </div>
            <div class="flex space-x-3">
                <button onclick="printExam()" class="px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm flex items-center gap-2 transition">
                    <i class="fa-solid fa-print"></i> 打印预览
                </button>
                <button onclick="exportToWord()" class="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-2 transition">
                    <i class="fa-solid fa-file-word"></i> 导出Word
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Left Sidebar: Configuration -->
        <aside class="w-1/3 bg-white border-r border-gray-200 flex flex-col overflow-y-auto shadow-inner z-10">
            <div class="p-6 space-y-6">
                
                <!-- API Key Section -->
                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                    <label class="block text-sm font-bold text-indigo-900 mb-2">
                        <i class="fa-solid fa-key mr-1"></i> 模型设置
                    </label>
                    
                    <select id="apiProvider" onchange="toggleModelSelect()" class="w-full mb-2 text-sm border-gray-300 rounded-md shadow-sm p-2 border focus:ring-2 focus:ring-indigo-500">
                        <option value="gemini">Google Gemini (推荐)</option>
                        <option value="custom">SiliconFlow / 自定义 (OpenAI兼容)</option>
                        <option value="openai">OpenAI (官方)</option>
                    </select>

                    <!-- Gemini Options -->
                    <div id="geminiModelSelect" class="mb-2">
                        <select id="geminiModelId" class="w-full text-sm border-gray-300 rounded-md shadow-sm p-2 border focus:ring-2 focus:ring-indigo-500">
                            <option value="gemini-2.5-flash-preview-09-2025">gemini-2.5-flash (最新)</option>
                            <option value="gemini-1.5-pro">gemini-1.5-pro (推理强)</option>
                            <option value="gemini-1.5-flash">gemini-1.5-flash (稳定)</option>
                        </select>
                    </div>

                    <!-- Custom / SiliconFlow Options -->
                    <div id="customConfig" class="mb-2 hidden space-y-2 border-l-2 border-indigo-300 pl-2">
                        <div>
                            <label class="block text-[10px] text-gray-500">Base URL (API地址)</label>
                            <input type="text" id="customBaseUrl" value="https://api.siliconflow.cn/v1" placeholder="https://api.siliconflow.cn/v1" class="w-full text-xs border-gray-300 rounded-md p-1 border">
                        </div>
                        <div>
                            <label class="block text-[10px] text-gray-500">Model ID (模型名称)</label>
                            <input type="text" id="customModelId" value="deepseek-ai/DeepSeek-V3" placeholder="例如: deepseek-ai/DeepSeek-V3" class="w-full text-xs border-gray-300 rounded-md p-1 border">
                            <p class="text-[10px] text-gray-400">提示: 硅基流动常用 deepseek-ai/DeepSeek-V3 或 Qwen/Qwen2.5-72B-Instruct</p>
                        </div>
                    </div>

                    <input type="password" id="apiKey" placeholder="输入 API Key (sk-...)" class="w-full text-sm border-gray-300 rounded-md shadow-sm p-2 border focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- Step 1: Upload -->
                <div>
                    <h2 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                        <span class="bg-gray-200 text-gray-700 rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">1</span>
                        导入知识库文件 (PDF)
                    </h2>
                    <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-colors cursor-pointer relative group">
                        <input type="file" id="fileInput" multiple accept=".pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        <i class="fa-solid fa-book-medical text-3xl text-gray-400 mb-2 group-hover:text-indigo-500 transition"></i>
                        <p class="text-sm text-gray-600">点击或拖拽上传</p>
                        <p class="text-xs text-gray-400 mt-1">系统将综合所有文件内容出题</p>
                    </div>
                    <div id="fileList" class="mt-3 space-y-2 text-sm"></div>
                    <div id="uploadStatus" class="mt-2 text-xs text-gray-500 hidden">解析中...</div>
                </div>

                <!-- Step 2: Exam Config -->
                <div>
                    <h2 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                        <span class="bg-gray-200 text-gray-700 rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">2</span>
                        试卷基本信息
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">试卷主标题</label>
                            <input type="text" id="examTitle" value="2025年临床药师规范化培训专业考核试卷" class="w-full text-sm border-gray-300 rounded-md p-2 border focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                </div>

                <!-- Step 3: Question Count -->
                <div>
                    <h2 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                        <span class="bg-gray-200 text-gray-700 rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">3</span>
                        题型数量配置
                    </h2>
                    <div class="grid grid-cols-2 gap-4 bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">A型题 (单选)</label>
                            <input type="number" id="countA" value="5" min="0" class="w-full text-sm border-gray-300 rounded-md text-center p-1 border">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">B型题 (配伍组)</label>
                            <input type="number" id="countB" value="1" min="0" class="w-full text-sm border-gray-300 rounded-md text-center p-1 border">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">X型题 (多选)</label>
                            <input type="number" id="countX" value="2" min="0" class="w-full text-sm border-gray-300 rounded-md text-center p-1 border">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">案例分析题</label>
                            <input type="number" id="countCase" value="1" min="0" class="w-full text-sm border-gray-300 rounded-md text-center p-1 border">
                        </div>
                    </div>
                </div>

                <button id="generateBtn" onclick="generateExam()" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-bold shadow-md transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> 基于知识库生成
                </button>
            </div>
        </aside>

        <!-- Right Preview Area -->
        <main class="w-2/3 bg-gray-200 p-8 overflow-y-auto flex justify-center">
            
            <!-- A4 Paper Container -->
            <div id="previewContainer" class="paper-container exam-content relative">
                
                <!-- Placeholder State -->
                <div id="placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 z-0">
                    <i class="fa-solid fa-book-open text-6xl mb-4 opacity-30"></i>
                    <p class="text-lg font-serif">知识库准备就绪</p>
                    <p class="text-sm opacity-60">请在左侧上传文件并点击生成</p>
                </div>

                <!-- Result Content Will Be Injected Here -->
                <div id="markdownOutput" class="relative z-10 min-h-[500px]"></div>

            </div>
        </main>

    </main>

    <script>
        // State
        let extractedText = "";
        let filesProcessed = 0;
        let totalFiles = 0;

        // UI References
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const uploadStatus = document.getElementById('uploadStatus');
        const markdownOutput = document.getElementById('markdownOutput');
        const placeholder = document.getElementById('placeholder');
        const generateBtn = document.getElementById('generateBtn');

        // Toggle Model Select
        function toggleModelSelect() {
            const provider = document.getElementById('apiProvider').value;
            const geminiSelect = document.getElementById('geminiModelSelect');
            const customConfig = document.getElementById('customConfig');

            // Hide all first
            geminiSelect.classList.add('hidden');
            customConfig.classList.add('hidden');

            if (provider === 'gemini') {
                geminiSelect.classList.remove('hidden');
            } else if (provider === 'custom') {
                customConfig.classList.remove('hidden');
            }
        }

        // --- File Handling ---
        fileInput.addEventListener('change', handleFileSelect);

        async function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            totalFiles = files.length;
            filesProcessed = 0;
            extractedText = "";
            fileList.innerHTML = '';
            uploadStatus.classList.remove('hidden');
            uploadStatus.textContent = `正在解析 PDF (0/${totalFiles})...`;
            generateBtn.disabled = true;

            for (let file of files) {
                // UI Item
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-gray-50 p-2 rounded border border-gray-100";
                div.innerHTML = `<span class="truncate w-4/5 text-gray-700"><i class="fa-solid fa-file-pdf text-red-500 mr-2"></i>${file.name}</span><i class="fa-solid fa-spinner fa-spin text-gray-400"></i>`;
                fileList.appendChild(div);

                try {
                    const text = await parsePdf(file);
                    extractedText += `\n\n=== 知识库文件: ${file.name} ===\n${text}\n=====================\n`;
                    div.querySelector('.fa-spinner').className = "fa-solid fa-check text-green-500";
                } catch (e) {
                    console.error(e);
                    div.querySelector('.fa-spinner').className = "fa-solid fa-triangle-exclamation text-red-500";
                    div.title = "解析失败";
                }
                
                filesProcessed++;
                uploadStatus.textContent = `正在解析 PDF (${filesProcessed}/${totalFiles})...`;
            }

            uploadStatus.textContent = "知识库构建完成，准备生成。";
            generateBtn.disabled = false;
        }

        async function parsePdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = "";

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + "\n";
            }
            return fullText;
        }

        // --- Generation Logic ---
        async function generateExam() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const provider = document.getElementById('apiProvider').value;
            const examTitle = document.getElementById('examTitle').value;
            
            if (!apiKey) {
                alert("请先输入 API Key 才能生成试题。");
                return;
            }

            if (!extractedText) {
                alert("请先上传PDF文件作为知识库。");
                return;
            }

            // UI Loading
            generateBtn.disabled = true;
            generateBtn.innerHTML = `<div class="loader mr-2"></div> 综合分析知识库...`;
            placeholder.classList.add('hidden');
            markdownOutput.innerHTML = `<div class="flex flex-col items-center justify-center pt-20 text-gray-500"><div class="loader mb-4" style="width:48px;height:48px;border-width:6px"></div><p>正在读取并综合所有导入文件...</p><p class="text-xs mt-2">严格依据知识库内容与标准考点设计题目...</p></div>`;

            // Config
            const config = {
                A: document.getElementById('countA').value,
                B: document.getElementById('countB').value,
                X: document.getElementById('countX').value,
                Case: document.getElementById('countCase').value
            };

            // Enhanced System Prompt for Knowledge Base
            const systemPrompt = `你是一个专业的临床药师考试命题专家。
            
            **【核心任务】**：
            用户导入的所有文件内容构成了本次考试的**【专属知识库】**。你需要综合阅读并理解知识库中的所有信息，生成一份严格符合《20180628出题格式》的试卷。
            
            **【内容来源铁律】**：
            1. **严格溯源**：所有的考点、病例数据、药物选择依据、治疗原则，**必须严格来源于用户提供的【知识库内容】**。
            2. **综合出题**：如果用户上传了多份文件，请尝试在试卷中综合涵盖这些文件中的重点内容。
            3. **禁止幻觉**：不要编造知识库中不存在的“事实”。

             **【考试内容深度与重点 (关键要求)】**：
            1. **核心能力考核**：试题必须重点考核**药学监护能力**，而非单纯的记忆。
               - 具体包括：药物选择的合理性、用法用量(含溶媒/滴速)、剂型适宜性、治疗方案的评估与优化。
               - 必须涉及：循证医学证据、药物相互作用、主要ADR鉴别与处理、患者教育要点、用药风险评估。
            2. **复杂病例覆盖**：
               - 试卷中必须包含一定比例的**复杂病例**或**复杂药物治疗问题**（在A/B/X/案例题中均可体现）。
               - 复杂点需涵盖：严重的药物相互作用、特殊人群（肝肾功能不全、老年、儿童、妊娠）、高危药品（抗凝、化疗、精麻）、特殊剂型（缓控释、吸入剂）的临床应用。

            **【知识点标注规范 (必须严格遵守)】**：
            每道题（包括案例分析的小题）的题干末尾**必须**标注知识点。请根据题目内容，从以下列表中选择最贴切的一个：
            （11）选定五种疾病相关医学基础（解剖、生理等）
            （12）选定五种疾病相关临床检验所代表的临床意义
            （13）选定五种疾病临床表现
            （14）选定五种疾病疾病诊断
            （15）选定五种疾病疾病治疗
            （16）药物适应症、禁忌证
            （17）药代、药效
            （18）个体化给药方案的制定
            （19）药物不良反应
            （20）药物相互作用
            （21）个体化药学监护计划的制定
            （22）个体化用药教育方案的设计
            
            格式示例：...题干内容...（    ）*【（15）选定五种疾病疾病治疗】*

            **【排版指令】(必须完全一致)：**
            1. **试卷结构**：
               - # ${examTitle}
               - **姓名：______ 科室：______ 分数：______ 考试时间：______**
               - ## 一、A型题（每题选项5个。多选、错选均不得分。共${config.A}题）
               - ## 二、B型题（每题选项5个。多选、错选均不得分，少选酌情给分。共${config.B}组）
               - ## 三、X型题（每题选项5个。多选、错选均不得分。共${config.X}题）
               - ## 四、案例分析题（共${config.Case}个案例。每个案例至少5个问题，每个问题4个选项）
               - (分页符)
               - # 参考答案 (单独列在文档最后)

            2. **题目序号与格式**：
               - **必须**给每一个题目加上序号。例如：**1.**、**2.**。
               - 案例分析题的小题也要编号，例如：**1)**、**2)**。

            3. **题型设计规范**：
               - **A型题 (最佳选择题)**：
                 - **题干要求**：必须采用**临床案例摘要**，以**叙述式**书写（禁止简单的知识点问答）。
                 - **表述要求**：尽可能采用**肯定性陈述句**。
                 - **否定词处理**：如果必须采用否定性陈述（如“不包括”、“不宜”），其否定词必须用 **Markdown加粗**（如 **不**）以提醒应试者。
                 - **选项要求**：每题5个选项，单选。
               - **X型题**：每题5个选项。多选题。
               - **B型题**：先列**5个选项**(A~E)，然后列出2-3个题干。
               - **案例分析题**：每个案例设计**不少于5个问题**。每个问题设计**4个选项**。

            4. **答案分离**：
               - **绝对不要**在题目旁边显示答案。
               - 在文档最后生成 **# 参考答案** 部分。

            **生成数量：** A型题:${config.A}, B型题:${config.B}组, X型题:${config.X}, 案例题:${config.Case}个。

            **输出格式：** 纯Markdown，不要代码块标记。
            `;

            const userPrompt = `【知识库内容如下】：\n\n${extractedText.substring(0, 70000)}`; 

            try {
                let markdownResult = "";
                
                if (provider === 'gemini') {
                    const geminiModel = document.getElementById('geminiModelId').value;
                    markdownResult = await callGemini(apiKey, geminiModel, systemPrompt, userPrompt);
                } else if (provider === 'openai') {
                    markdownResult = await callOpenAI(apiKey, 'https://api.openai.com/v1', 'gpt-4-turbo', systemPrompt, userPrompt);
                } else if (provider === 'custom') {
                    const baseUrl = document.getElementById('customBaseUrl').value.replace(/\/$/, ""); // trim trailing slash
                    const modelId = document.getElementById('customModelId').value;
                    markdownResult = await callOpenAI(apiKey, baseUrl, modelId, systemPrompt, userPrompt);
                }

                renderResult(markdownResult);

            } catch (error) {
                console.error(error);
                let errorMsg = error.message;
                
                if (errorMsg.includes("404") || errorMsg.includes("not found")) {
                    errorMsg = `错误：找不到模型或API路径。\n请检查您的Base URL或模型名称是否正确。`;
                }

                alert("生成失败，请查看右侧详情。");
                markdownOutput.innerHTML = `<div class="text-center text-red-500 p-8"><p class="text-xl font-bold mb-2">生成出错</p><p class="text-sm bg-red-50 p-4 rounded text-left whitespace-pre-wrap">${errorMsg}</p></div>`;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles"></i> 基于知识库生成`;
            }
        }

        // --- API Calls ---
        async function callGemini(key, modelId, system, user) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${key}`;
            const payload = {
                contents: [
                    { role: "user", parts: [{ text: system + "\n\n" + user }] }
                ]
            };
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                const errorMsg = data.error ? data.error.message : response.statusText;
                throw new Error(`Gemini API Error (${response.status}): ${errorMsg}`);
            }
            
            if (!data.candidates || data.candidates.length === 0) {
                 throw new Error("模型未返回任何内容。");
            }

            return data.candidates[0].content.parts[0].text;
        }

        async function callOpenAI(key, baseUrl, modelId, system, user) {
            const url = `${baseUrl}/chat/completions`;
            const payload = {
                model: modelId, 
                messages: [
                    { role: "system", content: system },
                    { role: "user", content: user }
                ]
            };
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${key}`
                },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                const errorMsg = data.error ? data.error.message : "Network/Auth Error";
                throw new Error(`API Error: ${errorMsg}`);
            }

            if (!data.choices || data.choices.length === 0) {
                 throw new Error("模型未返回任何内容。");
            }

            return data.choices[0].message.content;
        }

        // --- Rendering & Post-Processing ---
        function renderResult(markdown) {
            // Render basic Markdown
            markdownOutput.innerHTML = marked.parse(markdown);
            
            // Post-process HTML for styling
            // 1. 知识点样式优化
            const ems = markdownOutput.querySelectorAll('em');
            ems.forEach(em => {
                if (em.innerText.includes('【')) {
                    em.className = 'knowledge-point';
                }
            });

            // 2. 试卷头居中优化
            const ps = markdownOutput.querySelectorAll('p');
            ps.forEach(p => {
                if (p.innerText.includes('姓名：')) {
                    p.className = 'exam-header-info';
                }
            });

            // 3. Highlight "参考答案" section for visibility
            const h1s = markdownOutput.querySelectorAll('h1');
            h1s.forEach(h1 => {
                if (h1.innerText.includes('参考答案')) {
                    h1.style.color = '#dc2626'; // Red color for answer key title
                    h1.style.marginTop = '40px';
                    h1.style.borderTop = '2px dashed #ccc';
                    h1.style.paddingTop = '20px';
                    h1.style.pageBreakBefore = 'always'; // Ensure new page for answers when printing
                }
            });
        }

        function printExam() {
            window.print();
        }

        function exportToWord() {
            const content = document.getElementById('markdownOutput').innerText;
            if (!content) {
                alert("没有可导出的内容");
                return;
            }
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${document.getElementById('examTitle').value}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

    </script>
</body>
</html>
